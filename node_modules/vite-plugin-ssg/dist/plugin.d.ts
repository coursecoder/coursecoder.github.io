import { PluginOption, BuildOptions, LogLevel, Plugin } from 'vite';
export { BuildOptions, LogLevel, PluginOption } from 'vite';
import { ComponentType, ReactNode } from 'react';

/**
 * Static Site Generation Types
 *
 * Types for configuring the SSG system and individual pages.
 * Uses Vite's exported types where applicable for consistency.
 */

/**
 * Image optimization configuration
 */
interface ImageOptimizationConfig {
    /** Enable/disable image optimization @default true */
    enabled?: boolean;
    /** Output formats to generate @default ['webp'] */
    formats?: ('webp' | 'avif' | 'original')[];
    /** Quality for lossy compression (1-100) @default 80 */
    quality?: number;
    /** Generate srcset for responsive images @default true */
    generateSrcset?: boolean;
    /** Multipliers for srcset @default [1, 2] */
    srcsetMultipliers?: number[];
    /** Number of LCP images to preload @default 4 */
    lcpImageCount?: number;
}
/**
 * CSS build configuration
 * Uses Vite's cssMinify type for the minify option
 */
interface CssConfig {
    /** CSS minifier to use @default 'lightningcss' */
    minify?: BuildOptions['cssMinify'];
    /** Path to global CSS file to include @default 'src/index.css' */
    globalCssPath?: string;
}
/**
 * JavaScript/hydration build configuration
 * Uses Vite's BuildOptions types for minify and target
 */
interface JsConfig {
    /** JS minifier to use @default 'terser' */
    minify?: BuildOptions['minify'];
    /** ES target for output @default 'es2020' */
    target?: BuildOptions['target'];
    /** Terser-specific options (only used when minify: 'terser') */
    terserOptions?: {
        /** Remove console.* calls @default true */
        dropConsole?: boolean;
        /** Remove debugger statements @default true */
        dropDebugger?: boolean;
        /** Number of compression passes @default 2 */
        passes?: number;
    };
}
/**
 * HTML template configuration
 */
interface HtmlConfig {
    /** Additional tags to inject into <head> */
    headTags?: string;
    /** Additional tags to inject at end of <body> */
    bodyTags?: string;
    /** HTML lang attribute @default 'en' */
    lang?: string;
}
/**
 * Vite plugin configuration
 */
interface VitePluginsConfig {
    /** Additional Vite plugins to include */
    plugins?: PluginOption[];
}
/**
 * Main SSG build configuration
 *
 * @example
 * ```typescript
 * const config: SsgBuildConfig = {
 *   outDir: 'dist/static',
 *   baseUrl: '/static',
 *   vite: {
 *     plugins: [myCustomPlugin()],
 *   },
 *   images: {
 *     quality: 85,
 *     formats: ['webp', 'avif'],
 *   },
 *   css: {
 *     minify: 'lightningcss',
 *   },
 *   js: {
 *     minify: 'terser',
 *     target: 'es2020',
 *   },
 * };
 * ```
 */
interface SsgBuildConfig {
    /** Output directory for static files @default 'dist/static' */
    outDir?: string;
    /** Base URL path for assets @default '/static' */
    baseUrl?: string;
    /** Source directory @default 'src' */
    srcDir?: string;
    /** Vite plugins configuration */
    vite?: VitePluginsConfig;
    /** Image optimization settings */
    images?: ImageOptimizationConfig;
    /** CSS build settings */
    css?: CssConfig;
    /** JavaScript build settings */
    js?: JsConfig;
    /** HTML template settings */
    html?: HtmlConfig;
    /** Log level (uses Vite's LogLevel type) @default 'info' */
    logLevel?: LogLevel | 'debug';
}
/**
 * Resolved configuration with all defaults applied
 * All optional fields become required with default values
 */
interface ResolvedSsgConfig {
    outDir: string;
    baseUrl: string;
    srcDir: string;
    vite: Required<VitePluginsConfig>;
    images: Required<ImageOptimizationConfig>;
    css: Required<CssConfig>;
    js: Required<JsConfig>;
    html: Required<HtmlConfig>;
    logLevel: LogLevel | 'debug';
}

/**
 * Vite SSG Plugin Types
 *
 * Configuration types for the Vite Static Site Generation plugin.
 */

/**
 * Hosting platform configuration
 */
interface HostingConfig {
    /**
     * Path to firebase.json file.
     * When provided, the plugin will update Firebase hosting rewrites
     * to serve static pages at their configured routes.
     *
     * @example "../firebase.json"
     */
    firebaseJson?: string;
}
/**
 * Plugin options for vite-plugin-ssg
 *
 * @example
 * ```typescript
 * import { ssgPlugin } from './static-gen/plugin';
 *
 * export default defineConfig({
 *   plugins: [
 *     ssgPlugin({
 *       // Required: pages to generate
 *       pages: 'src/pages/HomePage.tsx',
 *       // or folder
 *       pages: 'src/pages/',
 *       // or array
 *       pages: ['src/pages/HomePage.tsx', 'src/pages/AboutPage.tsx'],
 *
 *       // Optional: SSG build configuration
 *       config: {
 *         outDir: 'dist/static',
 *         baseUrl: '/static',
 *         images: { quality: 90 },
 *       },
 *
 *       // Optional: Hosting platform configuration
 *       hosting: {
 *         firebaseJson: '../firebase.json',
 *       },
 *     }),
 *   ],
 * });
 * ```
 */
interface SsgPluginOptions {
    /**
     * Pages to generate static HTML for.
     * Can be a single file path, folder path, or array of paths.
     *
     * - File path: Generate static HTML for that specific page
     * - Folder path: Scan folder for files with `ssgOptions` export
     * - Array: Process multiple files/folders
     *
     * Paths are relative to the project root.
     */
    pages: string | string[];
    /**
     * SSG build configuration options.
     * These override the defaults for image optimization, CSS/JS minification, etc.
     */
    config?: SsgBuildConfig;
    /**
     * Hosting platform configuration.
     * Configure rewrites/redirects for your hosting platform.
     */
    hosting?: HostingConfig;
    /**
     * Whether to run SSG during development builds.
     * @default false
     */
    runInDev?: boolean;
    /**
     * Enable dev server middleware to simulate hosting rewrites.
     * When enabled, the dev server will serve static pages if they exist,
     * or show a helpful message if they haven't been generated yet.
     * @default true
     */
    devMiddleware?: boolean;
    /**
     * Enable verbose logging
     * @default false
     */
    verbose?: boolean;
}

/**
 * Vite SSG Plugin
 *
 * A Vite plugin for generating static HTML pages from React components.
 *
 * @example
 * ```typescript
 * // vite.config.ts
 * import { defineConfig } from 'vite';
 * import react from '@vitejs/plugin-react';
 * import { ssgPlugin } from './src/static-gen/plugin';
 *
 * export default defineConfig({
 *   plugins: [
 *     react(),
 *     ssgPlugin({
 *       pages: 'src/pages/',
 *       config: {
 *         outDir: 'dist/static',
 *         baseUrl: '/static',
 *       },
 *       hosting: {
 *         firebaseJson: '../firebase.json',
 *       },
 *     }),
 *   ],
 * });
 * ```
 */

/**
 * Create the Vite SSG plugin
 *
 * This plugin generates static HTML pages during the build process
 * using the `writeBundle` hook, which runs after files are written to disk.
 *
 * @param options - Plugin configuration options
 * @returns Vite plugin object
 */
declare function ssgPlugin(options: SsgPluginOptions): Plugin;

/**
 * Static Site Generator
 *
 * Main entry point for generating static HTML pages from React components.
 *
 * Usage:
 *   npx tsx src/static-gen/gen-static.ts <file-or-folder>
 *
 * Examples:
 *   npx tsx src/static-gen/gen-static.ts src/pages/HomePage.tsx
 *   npx tsx src/static-gen/gen-static.ts src/pages/
 */

/**
 * Generate static pages from file or folder input
 *
 * @param input - Path to a file or folder containing pages
 * @param userConfig - Optional build configuration
 * @returns Promise that resolves when all pages are generated
 *
 * @example
 * ```typescript
 * import { generateStatic } from './static-gen/gen-static';
 *
 * // With defaults
 * await generateStatic('src/pages/');
 *
 * // With custom config
 * await generateStatic('src/pages/', {
 *   outDir: 'dist/static',
 *   baseUrl: '/static',
 *   images: { quality: 90 },
 *   js: { minify: 'esbuild' },
 * });
 * ```
 */
declare function generateStatic(input: string, userConfig?: SsgBuildConfig): Promise<void>;

/**
 * SSG Configuration
 *
 * Default configuration and resolver for merging user config with defaults.
 */

/**
 * Default configuration values
 */
declare const DEFAULT_CONFIG: ResolvedSsgConfig;
/**
 * Resolve user configuration by merging with defaults
 *
 * @param userConfig - Partial user configuration
 * @returns Fully resolved configuration with all defaults applied
 */
declare function resolveConfig(userConfig?: SsgBuildConfig): ResolvedSsgConfig;

/**
 * vite-plugin-ssg/utils
 *
 * Browser-safe utility types for SSG pages.
 * This entry point can be safely imported in browser code.
 */

/**
 * Context wrapper function type
 * Wraps the page component with providers (Router, QueryClient, etc.)
 * Can be async to allow dynamic imports of server-only components
 */
type ContextWrapper = (children: ReactNode) => Promise<ReactNode> | ReactNode;
/**
 * Static Site Generation Options for a page
 *
 * Export this from any page component to enable static generation.
 *
 * @example
 * ```tsx
 * import type { SsgOptions } from 'vite-plugin-ssg/utils';
 *
 * export const ssgOptions: SsgOptions = {
 *   slug: 'home',
 *   routeUrl: '/',
 *   Head: () => (
 *     <>
 *       <title>My Page</title>
 *       <meta name="description" content="..." />
 *     </>
 *   ),
 *   context: async (children) => {
 *     const { StaticRouter } = await import('react-router-dom/server');
 *     const { QueryClientProvider, QueryClient } = await import('@tanstack/react-query');
 *     const queryClient = new QueryClient();
 *     return (
 *       <QueryClientProvider client={queryClient}>
 *         <StaticRouter location="/">
 *           {children}
 *         </StaticRouter>
 *       </QueryClientProvider>
 *     );
 *   },
 * };
 * ```
 */
interface SsgOptions {
    /**
     * Output slug - determines the output filename
     * e.g., "home" -> "dist/static/home.html"
     */
    slug: string;
    /**
     * Route URL for react-router
     * Used for hydration consistency with MemoryRouter
     * @default "/"
     */
    routeUrl?: string;
    /**
     * Head component that renders meta tags, title, etc.
     * Will be rendered into the <head> section of the HTML
     */
    Head?: ComponentType;
    /**
     * Context wrapper function
     * Wraps the page component with providers needed for SSR
     * Can be async to dynamically import server-only components like StaticRouter
     *
     * @param children - The page component to wrap
     * @returns The wrapped component tree with all providers
     */
    context?: ContextWrapper;
}

export { type ContextWrapper, type CssConfig, DEFAULT_CONFIG, type HostingConfig, type HtmlConfig, type ImageOptimizationConfig, type JsConfig, type ResolvedSsgConfig, type SsgBuildConfig, type SsgOptions, type SsgPluginOptions, type VitePluginsConfig, generateStatic, resolveConfig, ssgPlugin };
